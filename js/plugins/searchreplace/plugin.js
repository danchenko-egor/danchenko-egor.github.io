(function(){"use strict";const e=e=>{let t=e;const n=()=>t,o=e=>{t=e};return{get:n,set:o}};var t=tinymce.util.Tools.resolve("tinymce.PluginManager");const n=(e,t,n)=>{var o;return!!n(e,t.prototype)||(null===(o=e.constructor)||void 0===o?void 0:o.name)===t.name},o=e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&n(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":t},r=e=>t=>o(t)===e,s=e=>t=>typeof t===e,a=r("string"),l=r("array"),i=s("boolean"),c=e=>null===e||void 0===e,d=e=>!c(e),m=s("number"),u=()=>{},h=e=>()=>e,g=h(!0),f="[!-#%-*,-\\/:;?@\\[-\\]_{}¡«·»¿;·՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾࡞।॥॰෴๏๚๛༄-༒༺-༽྅࿐-࿔࿙࿚၊-၏჻፡-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᨞᨟᪠-᪦᪨-᪭᭚-᭠᯼-᯿᰻-᰿᱾᱿᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⵰⸀-⸮⸰⸱、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･]",p=h(f);class x{constructor(e,t){this.tag=e,this.value=t}static some(e){return new x(!0,e)}static none(){return x.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?x.some(e(this.value)):x.none()}bind(e){return this.tag?e(this.value):x.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:x.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!==e&&void 0!==e?e:"Called getOrDie on None")}static from(e){return d(e)?x.some(e):x.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}x.singletonNone=new x(!1);const y=p;var w=tinymce.util.Tools.resolve("tinymce.Env"),v=tinymce.util.Tools.resolve("tinymce.util.Tools");const b=Array.prototype.slice,C=Array.prototype.push,E=(e,t)=>{const n=e.length,o=new Array(n);for(let r=0;r<n;r++){const n=e[r];o[r]=t(n,r)}return o},N=(e,t)=>{for(let n=0,o=e.length;n<o;n++){const o=e[n];t(o,n)}},T=(e,t)=>{for(let n=e.length-1;n>=0;n--){const o=e[n];t(o,n)}},O=(e,t)=>{if(0===e.length)return[];{let n=t(e[0]);const o=[];let r=[];for(let s=0,a=e.length;s<a;s++){const a=e[s],l=t(a);l!==n&&(o.push(r),r=[]),n=l,r.push(a)}return 0!==r.length&&o.push(r),o}},k=(e,t,n)=>(N(e,((e,o)=>{n=t(n,e,o)})),n),A=e=>{const t=[];for(let n=0,o=e.length;n<o;++n){if(!l(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);C.apply(t,e[n])}return t},S=(e,t)=>A(E(e,t)),D=(e,t)=>{const n=b.call(e,0);return n.sort(t),n},M=Object.hasOwnProperty,B=(e,t)=>M.call(e,t);"undefined"!==typeof window?window:Function("return this;")();const F=9,I=11,R=1,P=3,W=e=>e.dom.nodeType,$=e=>t=>W(t)===e,V=$(P),j=(e,t,n)=>{if(!(a(n)||i(n)||m(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")},H=(e,t,n)=>{j(e.dom,t,n)},_=(e,t)=>{const n=t||document,o=n.createElement("div");if(o.innerHTML=e,!o.hasChildNodes()||o.childNodes.length>1){const t="HTML does not have a single root node";throw console.error(t,e),new Error(t)}return U(o.childNodes[0])},z=(e,t)=>{const n=t||document,o=n.createElement(e);return U(o)},L=(e,t)=>{const n=t||document,o=n.createTextNode(e);return U(o)},U=e=>{if(null===e||void 0===e)throw new Error("Node cannot be null or undefined");return{dom:e}},q=(e,t,n)=>x.from(e.dom.elementFromPoint(t,n)).map(U),G={fromHtml:_,fromTag:z,fromText:L,fromDom:U,fromPoint:q},K=e=>e.nodeType!==R&&e.nodeType!==F&&e.nodeType!==I||0===e.childElementCount,J=(e,t)=>{const n=void 0===t?document:t.dom;return K(n)?[]:E(n.querySelectorAll(e),G.fromDom)},Q=e=>x.from(e.dom.parentNode).map(G.fromDom),X=e=>E(e.dom.childNodes,G.fromDom),Y=(e,t)=>({element:e,offset:t}),Z=(e,t)=>{const n=X(e);return n.length>0&&t<n.length?Y(n[t],0):Y(e,t)},ee=(e,t)=>{const n=Q(e);n.each((n=>{n.dom.insertBefore(t.dom,e.dom)}))},te=(e,t)=>{e.dom.appendChild(t.dom)},ne=(e,t)=>{ee(e,t),te(t,e)},oe=(e,t)=>{const n=n=>{if(!e(n))throw new Error("Can only get "+t+" value of a "+t+" node");return o(n).getOr("")},o=t=>e(t)?x.from(t.dom.nodeValue):x.none(),r=(n,o)=>{if(!e(n))throw new Error("Can only set raw "+t+" value of a "+t+" node");n.dom.nodeValue=o};return{get:n,getOption:o,set:r}},re=oe(V,"text"),se=e=>re.get(e),ae=(e,t,n)=>0!==(e.compareDocumentPosition(t)&n),le=(e,t)=>ae(e,t,Node.DOCUMENT_POSITION_PRECEDING),ie=(e,t)=>J(t,e);var ce=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker");const de=(e,t)=>e.isBlock(t)||B(e.schema.getVoidElements(),t.nodeName),me=(e,t)=>"false"===e.getContentEditable(t),ue=(e,t)=>"true"===e.getContentEditable(t)&&t.parentNode&&"false"===e.getContentEditableParent(t.parentNode),he=(e,t)=>!e.isBlock(t)&&B(e.schema.getWhitespaceElements(),t.nodeName),ge=(e,t)=>de(e,t)||me(e,t)||he(e,t)||ue(e,t),fe=e=>3===e.nodeType,pe=()=>({sOffset:0,fOffset:0,elements:[]}),xe=(e,t)=>Z(G.fromDom(e),t),ye=(e,t,n,o,r,s=!0)=>{let a=s?t(!1):n;while(a){const n=me(e,a);if(n||he(e,a)){const e=n?o.cef(a):o.boundary(a);if(e)break;a=t(!0)}else{if(de(e,a)){if(o.boundary(a))break}else fe(a)&&o.text(a);if(a===r)break;a=t(!1)}}},we=(e,t,n,o,r)=>{var s;if(ge(e,n))return;const a=null!==(s=e.getParent(o,e.isBlock))&&void 0!==s?s:e.getRoot(),l=new ce(n,a),i=r?l.next.bind(l):l.prev.bind(l);ye(e,i,n,{boundary:g,cef:g,text:e=>{r?t.fOffset+=e.length:t.sOffset+=e.length,t.elements.push(G.fromDom(e))}})},ve=(e,t,n,o,r,s=!0)=>{const a=new ce(n,t),l=[];let i=pe();we(e,i,n,t,!1);const c=()=>(i.elements.length>0&&(l.push(i),i=pe()),!1);return ye(e,a.next.bind(a),n,{boundary:c,cef:e=>(c(),r&&l.push(...r.cef(e)),!1),text:e=>{i.elements.push(G.fromDom(e)),r&&r.text(e,i)}},o,s),o&&we(e,i,o,t,!0),c(),l},be=(e,t)=>{const n=xe(t.startContainer,t.startOffset),o=n.element.dom,r=xe(t.endContainer,t.endOffset),s=r.element.dom;return ve(e,t.commonAncestorContainer,o,s,{text:(e,t)=>{e===s?t.fOffset+=e.length-r.offset:e===o&&(t.sOffset+=n.offset)},cef:t=>{const n=S(ie(G.fromDom(t),"*[contenteditable=true]"),(t=>{const n=t.dom;return ve(e,n,n)}));return D(n,((e,t)=>le(e.elements[0].dom,t.elements[0].dom)?1:-1))}},!1)},Ce=(e,t)=>t.collapsed?[]:be(e,t),Ee=(e,t)=>{const n=e.createRng();return n.selectNode(t),Ce(e,n)},Ne=(e,t)=>S(t,(t=>Ee(e,t))),Te=(e,t,n=0,o=e.length)=>{const r=t.regex;r.lastIndex=n;const s=[];let a;while(a=r.exec(e)){const e=a[t.matchIndex],n=a.index+a[0].indexOf(e),l=n+e.length;if(l>o)break;s.push({start:n,finish:l}),r.lastIndex=l}return s},Oe=(e,t)=>{const n=k(e,((e,n)=>{const o=se(n),r=e.last,s=r+o.length,a=S(t,((e,t)=>e.start<s&&e.finish>r?[{element:n,start:Math.max(r,e.start)-r,finish:Math.min(s,e.finish)-r,matchId:t}]:[]));return{results:e.results.concat(a),last:s}}),{results:[],last:0}).results;return O(n,(e=>e.matchId))},ke=(e,t)=>S(t,(t=>{const n=t.elements,o=E(n,se).join(""),r=Te(o,e,t.sOffset,o.length-t.fOffset);return Oe(n,r)})),Ae=(e,t)=>{T(e,((e,n)=>{T(e,(e=>{const o=G.fromDom(t.cloneNode(!1));H(o,"data-mce-index",n);const r=e.element.dom;if(r.length===e.finish&&0===e.start)ne(e.element,o);else{r.length!==e.finish&&r.splitText(e.finish);const t=r.splitText(e.start);ne(G.fromDom(t),o)}}))}))},Se=(e,t,n,o)=>{const r=Ee(e,n),s=ke(t,r);return Ae(s,o),s.length},De=(e,t,n,o)=>{const r=n.getBookmark(),s=e.select("td[data-mce-selected],th[data-mce-selected]"),a=s.length>0?Ne(e,s):Ce(e,n.getRng()),l=ke(t,a);return Ae(l,o),n.moveToBookmark(r),l.length},Me=e=>e.getAttribute("data-mce-index"),Be=(e,t,n,o)=>{const r=e.dom.create("span",{"data-mce-bogus":1});r.className="mce-match-marker";const s=e.getBody();return ze(e,t,!1),o?De(e.dom,n,e.selection,r):Se(e.dom,n,s,r)},Fe=e=>{var t;const n=e.parentNode;e.firstChild&&n.insertBefore(e.firstChild,e),null===(t=e.parentNode)||void 0===t||t.removeChild(e)},Ie=(e,t)=>{const n=[],o=v.toArray(e.getBody().getElementsByTagName("span"));if(o.length)for(let r=0;r<o.length;r++){const e=Me(o[r]);null!==e&&e.length&&(e===t.toString()&&n.push(o[r]))}return n},Re=(e,t,n)=>{const o=t.get();let r=o.index;const s=e.dom;n?r+1===o.count?r=0:r++:r-1===-1?r=o.count-1:r--,s.removeClass(Ie(e,o.index),"mce-match-marker-selected");const a=Ie(e,r);return a.length?(s.addClass(Ie(e,r),"mce-match-marker-selected"),e.selection.scrollIntoView(a[0]),r):-1},Pe=(e,t)=>{const n=t.parentNode;e.remove(t),n&&e.isEmpty(n)&&e.remove(n)},We=(e,t)=>{const n=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n\\uFEFF]"),o="("+n+")";return t?`(?:^|\\s|${y()})`+o+`(?=$|\\s|${y()})`:o},$e=(e,t,n,o,r,s)=>{const a=e.selection,l=We(n,r),i=a.isForward(),c={regex:new RegExp(l,o?"g":"gi"),matchIndex:1},d=Be(e,t,c,s);if(w.browser.isSafari()&&a.setRng(a.getRng(),i),d){const a=Re(e,t,!0);t.set({index:a,count:d,text:n,matchCase:o,wholeWord:r,inSelection:s})}return d},Ve=(e,t)=>{const n=Re(e,t,!0);t.set({...t.get(),index:n})},je=(e,t)=>{const n=Re(e,t,!1);t.set({...t.get(),index:n})},He=e=>{const t=Me(e);return null!==t&&t.length>0},_e=(e,t,n,o,r)=>{const s=t.get(),a=s.index;let l,i=a;o=!1!==o;const c=e.getBody(),d=v.grep(v.toArray(c.getElementsByTagName("span")),He);for(let m=0;m<d.length;m++){const t=Me(d[m]);let c=l=parseInt(t,10);if(r||c===s.index){n.length?(d[m].innerText=n,Fe(d[m])):Pe(e.dom,d[m]);while(d[++m]){if(c=parseInt(Me(d[m]),10),c!==l){m--;break}Pe(e.dom,d[m])}o&&i--}else l>a&&d[m].setAttribute("data-mce-index",String(l-1))}return t.set({...s,count:r?0:s.count-1,index:i}),o?Ve(e,t):je(e,t),!r&&t.get().count>0},ze=(e,t,n)=>{let o,r;const s=t.get(),a=v.toArray(e.getBody().getElementsByTagName("span"));for(let l=0;l<a.length;l++){const e=Me(a[l]);null!==e&&e.length&&(e===s.index.toString()&&(o||(o=a[l].firstChild),r=a[l].firstChild),Fe(a[l]))}if(t.set({...s,index:-1,count:0,text:""}),o&&r){const t=e.dom.createRng();return t.setStart(o,0),t.setEnd(r,r.data.length),!1!==n&&e.selection.setRng(t),t}},Le=(e,t)=>t.get().count>1,Ue=(e,t)=>t.get().count>1,qe=(e,t)=>{const n=n=>ze(e,t,n),o=(n,o,r,s=!1)=>$e(e,t,n,o,r,s),r=()=>Ve(e,t),s=()=>je(e,t),a=(n,o,r)=>_e(e,t,n,o,r);return{done:n,find:o,next:r,prev:s,replace:a}},Ge=t=>{const n=e(x.none()),o=()=>n.get().each(t),r=()=>{o(),n.set(x.none())},s=()=>n.get().isSome(),a=()=>n.get(),l=e=>{o(),n.set(x.some(e))};return{clear:r,isSet:s,get:a,set:l}},Ke=()=>{const e=Ge(u),t=t=>e.get().each(t);return{...e,on:t}},Je=(e,t)=>{const n=Ke();e.undoManager.add();const o=v.trim(e.selection.getContent({format:"text"})),r=n=>{n.setEnabled("next",Le(e,t)),n.setEnabled("prev",Ue(e,t))},s=e=>{const n=e.getData(),o=t.get();t.set({...o,matchCase:n.matchcase,wholeWord:n.wholewords,inSelection:n.inselection})},a=(e,t)=>{const n=["replace","replaceall","prev","next"],o=n=>e.setEnabled(n,!t);N(n,o)},l=t=>{e.windowManager.alert("Could not find the specified string.",(()=>{t.focus("findtext")}))},i=(e,t)=>{w.browser.isSafari()&&w.deviceType.isTouch()&&("find"===t||"replace"===t||"replaceall"===t)&&e.focus(t)},c=n=>{ze(e,t,!1),a(n,!0),r(n)},d=n=>{const o=n.getData(),s=t.get();if(o.findtext.length){if(s.text===o.findtext&&s.matchCase===o.matchcase&&s.wholeWord===o.wholewords)Ve(e,t);else{const r=$e(e,t,o.findtext,o.matchcase,o.wholewords,o.inselection);r<=0&&l(n),a(n,0===r)}r(n)}else c(n)},m=t.get(),u={findtext:o,replacetext:"",wholewords:m.wholeWord,matchcase:m.matchCase,inselection:m.inSelection},h={title:"Find and Replace",size:"normal",body:{type:"panel",items:[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",enabled:!1,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",enabled:!1,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}]},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"},{type:"togglemenuitem",name:"inselection",text:"Find in selection"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",enabled:!1},{type:"custom",name:"replaceall",text:"Replace all",enabled:!1}],initialData:u,onChange:(e,n)=>{"findtext"===n.name&&t.get().count>0&&c(e)},onAction:(n,o)=>{const a=n.getData();switch(o.name){case"find":d(n);break;case"replace":_e(e,t,a.replacetext)?r(n):c(n);break;case"replaceall":_e(e,t,a.replacetext,!0,!0),c(n);break;case"prev":je(e,t),r(n);break;case"next":Ve(e,t),r(n);break;case"matchcase":case"wholewords":case"inselection":s(n),c(n);break}i(n,o.name)},onSubmit:e=>{d(e),i(e,"find")},onClose:()=>{e.focus(),ze(e,t),e.undoManager.add()}};n.set(e.windowManager.open(h,{inline:"toolbar"}))},Qe=(e,t)=>{e.addCommand("SearchReplace",(()=>{Je(e,t)}))},Xe=(e,t)=>()=>{Je(e,t)},Ye=(e,t)=>{e.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:Xe(e,t),icon:"search"}),e.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:Xe(e,t),icon:"search"}),e.shortcuts.add("Meta+F","",Xe(e,t))};var Ze=()=>{t.add("searchreplace",(t=>{const n=e({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1,inSelection:!1});return Qe(t,n),Ye(t,n),qe(t,n)}))};Ze()})();