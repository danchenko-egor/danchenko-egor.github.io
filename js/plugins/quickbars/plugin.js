(function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");const t=(e,t,o)=>{var r;return!!o(e,t.prototype)||(null===(r=e.constructor)||void 0===r?void 0:r.name)===t.name},o=e=>{const o=typeof e;return null===e?"null":"object"===o&&Array.isArray(e)?"array":"object"===o&&t(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":o},r=e=>t=>o(t)===e,n=e=>t=>typeof t===e,i=r("string"),s=n("boolean"),a=e=>null===e||void 0===e,l=e=>!a(e),c=n("function"),u=e=>t=>t.options.get(e),d=e=>{const t=e.options.register,o=e=>t=>{const o=s(t)||i(t);return o?s(t)?{value:t?e:"",valid:o}:{value:t.trim(),valid:o}:{valid:!1,message:"Must be a boolean or string."}},r="bold italic | quicklink h2 h3 blockquote";t("quickbars_selection_toolbar",{processor:o(r),default:r});const n="quickimage quicktable";t("quickbars_insert_toolbar",{processor:o(n),default:n});const a="alignleft aligncenter alignright";t("quickbars_image_toolbar",{processor:o(a),default:a})},m=u("quickbars_selection_toolbar"),h=u("quickbars_insert_toolbar"),g=u("quickbars_image_toolbar");let v=0;const f=e=>{const t=new Date,o=t.getTime(),r=Math.floor(1e9*Math.random());return v++,e+"_"+r+v+String(o)},b=(e,t,o)=>{e.execCommand("mceInsertTable",!1,{rows:o,columns:t})},p=(e,t,o)=>{const r=e.editorUpload.blobCache,n=r.create(f("mceu"),o,t);r.add(n),e.insertContent(e.dom.createHTML("img",{src:n.blobUri()}))},y=e=>new Promise((t=>{const o=new FileReader;o.onloadend=()=>{t(o.result.split(",")[1])},o.readAsDataURL(e)}));var k=tinymce.util.Tools.resolve("tinymce.Env"),w=tinymce.util.Tools.resolve("tinymce.util.Delay");const T=e=>new Promise((t=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.opacity="0.001",document.body.appendChild(o);const r=e=>{t(Array.prototype.slice.call(e.target.files))};o.addEventListener("change",r);const n=r=>{const i=()=>{var e;t([]),null===(e=o.parentNode)||void 0===e||e.removeChild(o)};k.os.isAndroid()&&"remove"!==r.type?w.setEditorTimeout(e,i,0):i(),e.off("focusin remove",n)};e.on("focusin remove",n),o.click()})),N=e=>{e.ui.registry.addButton("quickimage",{icon:"image",tooltip:"Insert image",onAction:()=>{T(e).then((t=>{if(t.length>0){const o=t[0];y(o).then((t=>{p(e,t,o)}))}}))}}),e.ui.registry.addButton("quicktable",{icon:"table",tooltip:"Insert table",onAction:()=>{b(e,2,2)}})},q=e=>()=>e,E=q(!1);class M{constructor(e,t){this.tag=e,this.value=t}static some(e){return new M(!0,e)}static none(){return M.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?M.some(e(this.value)):M.none()}bind(e){return this.tag?e(this.value):M.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:M.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!==e&&void 0!==e?e:"Called getOrDie on None")}static from(e){return l(e)?M.some(e):M.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}M.singletonNone=new M(!1),"undefined"!==typeof window?window:Function("return this;")();const C=1,_=e=>{const t=e.dom.nodeName;return t.toLowerCase()},S=(e,t)=>{const o=e.dom;return!(!o||!o.hasAttribute)&&o.hasAttribute(t)};var x=(e,t,o,r,n)=>e(o,r)?M.some(o):c(n)&&n(o)?M.none():t(o,r,n);const A=(e,t)=>{const o=t||document,r=o.createElement("div");if(r.innerHTML=e,!r.hasChildNodes()||r.childNodes.length>1){const t="HTML does not have a single root node";throw console.error(t,e),new Error(t)}return P(r.childNodes[0])},D=(e,t)=>{const o=t||document,r=o.createElement(e);return P(r)},O=(e,t)=>{const o=t||document,r=o.createTextNode(e);return P(r)},P=e=>{if(null===e||void 0===e)throw new Error("Node cannot be null or undefined");return{dom:e}},L=(e,t,o)=>M.from(e.dom.elementFromPoint(t,o)).map(P),B={fromHtml:A,fromTag:D,fromText:O,fromDom:P,fromPoint:L},I=(e,t)=>{const o=e.dom;if(o.nodeType!==C)return!1;{const e=o;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}},U=(e,t,o)=>{let r=e.dom;const n=c(o)?o:E;while(r.parentNode){r=r.parentNode;const e=B.fromDom(r);if(t(e))return M.some(e);if(n(e))break}return M.none()},F=(e,t,o)=>{const r=(e,t)=>t(e);return x(r,U,e,t,o)},H=(e,t,o)=>F(e,t,o).isSome(),R=(e,t,o)=>U(e,(e=>I(e,t)),o),j=(e,t,o)=>{const r=(e,t)=>I(e,t);return x(r,R,e,t,o)},z=e=>{const t=h(e);t.length>0&&e.ui.registry.addContextToolbar("quickblock",{predicate:t=>{const o=B.fromDom(t),r=e.schema.getTextBlockElements(),n=t=>t.dom===e.getBody();return!S(o,"data-mce-bogus")&&j(o,'table,[data-mce-bogus="all"]',n).fold((()=>H(o,(t=>_(t)in r&&e.dom.isEmpty(t.dom)),n)),E)},items:t,position:"line",scope:"editor"})},G=e=>{const t=t=>"false"!==e.dom.getContentEditableParent(t),o=e=>"IMG"===e.nodeName||"FIGURE"===e.nodeName&&/image/i.test(e.className),r=g(e);r.length>0&&e.ui.registry.addContextToolbar("imageselection",{predicate:o,items:r,position:"node"});const n=m(e);n.length>0&&e.ui.registry.addContextToolbar("textselection",{predicate:r=>!o(r)&&!e.selection.isCollapsed()&&t(r),items:n,position:"selection",scope:"editor"})};var $=()=>{e.add("quickbars",(e=>{d(e),N(e),z(e),G(e)}))};$()})();