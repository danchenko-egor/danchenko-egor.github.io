(function(){"use strict";const t=t=>{let e=t;const o=()=>e,n=t=>{e=t};return{get:o,set:n}};var e=tinymce.util.Tools.resolve("tinymce.PluginManager");const o=t=>{const e=()=>t.get();return{isEnabled:e}},n=(t,e)=>t.dispatch("VisualChars",{state:e}),r=(t,e,o)=>{var n;return!!o(t,e.prototype)||(null===(n=t.constructor)||void 0===n?void 0:n.name)===e.name},s=t=>{const e=typeof t;return null===t?"null":"object"===e&&Array.isArray(t)?"array":"object"===e&&r(t,String,((t,e)=>e.isPrototypeOf(t)))?"string":e},i=t=>e=>s(e)===t,a=t=>e=>typeof e===t,l=t=>e=>t===e,c=i("string"),u=l(null),d=a("boolean"),m=t=>null===t||void 0===t,h=t=>!m(t),g=a("number");class v{constructor(t,e){this.tag=t,this.value=e}static some(t){return new v(!0,t)}static none(){return v.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?v.some(t(this.value)):v.none()}bind(t){return this.tag?t(this.value):v.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:v.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!==t&&void 0!==t?t:"Called getOrDie on None")}static from(t){return h(t)?v.some(t):v.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}v.singletonNone=new v(!1);const f=(t,e)=>{const o=t.length,n=new Array(o);for(let r=0;r<o;r++){const o=t[r];n[r]=e(o,r)}return n},p=(t,e)=>{for(let o=0,n=t.length;o<n;o++){const n=t[o];e(n,o)}},w=(t,e)=>{const o=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e(r,n)&&o.push(r)}return o},y=Object.keys,b=(t,e)=>{const o=y(t);for(let n=0,r=o.length;n<r;n++){const r=o[n],s=t[r];e(s,r)}};"undefined"!==typeof window?window:Function("return this;")();const N=3,T=t=>t.dom.nodeType,A=t=>t.dom.nodeValue,k=t=>e=>T(e)===t,C=k(N),E=(t,e,o)=>{if(!(c(o)||d(o)||g(o)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",o,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,o+"")},L=(t,e,o)=>{E(t.dom,e,o)},O=(t,e)=>{const o=t.dom.getAttribute(e);return null===o?void 0:o},B=(t,e)=>{t.dom.removeAttribute(e)},D=(t,e)=>{const o=O(t,e);return void 0===o||""===o?[]:o.split(" ")},S=(t,e,o)=>{const n=D(t,e),r=n.concat([o]);return L(t,e,r.join(" ")),!0},V=(t,e,o)=>{const n=w(D(t,e),(t=>t!==o));return n.length>0?L(t,e,n.join(" ")):B(t,e),!1},x=t=>void 0!==t.dom.classList,j=t=>D(t,"class"),M=(t,e)=>S(t,"class",e),P=(t,e)=>V(t,"class",e),_=(t,e)=>{x(t)?t.dom.classList.add(e):M(t,e)},H=t=>{const e=x(t)?t.dom.classList:j(t);0===e.length&&B(t,"class")},F=(t,e)=>{if(x(t)){const o=t.dom.classList;o.remove(e)}else P(t,e);H(t)},I=(t,e)=>{const o=e||document,n=o.createElement("div");if(n.innerHTML=t,!n.hasChildNodes()||n.childNodes.length>1){const e="HTML does not have a single root node";throw console.error(e,t),new Error(e)}return U(n.childNodes[0])},K=(t,e)=>{const o=e||document,n=o.createElement(t);return U(n)},R=(t,e)=>{const o=e||document,n=o.createTextNode(t);return U(n)},U=t=>{if(null===t||void 0===t)throw new Error("Node cannot be null or undefined");return{dom:t}},$=(t,e,o)=>v.from(t.dom.elementFromPoint(e,o)).map(U),q={fromHtml:I,fromTag:K,fromText:R,fromDom:U,fromPoint:$},z={" ":"nbsp","­":"shy"},G=(t,e)=>{let o="";return b(t,((t,e)=>{o+=e})),new RegExp("["+o+"]",e?"g":"")},J=t=>{let e="";return b(t,(t=>{e&&(e+=","),e+="span.mce-"+t})),e},Q=G(z),W=G(z,!0),X=J(z),Y="mce-nbsp",Z=t=>'<span data-mce-bogus="1" class="mce-'+z[t]+'">'+t+"</span>",tt=t=>{const e=A(t);return C(t)&&c(e)&&Q.test(e)},et=(t,e)=>{let o=[];const n=t.dom,r=f(n.childNodes,q.fromDom);return p(r,(t=>{e(t)&&(o=o.concat([t])),o=o.concat(et(t,e))})),o},ot=(t,e)=>{while(t.parentNode){if(t.parentNode===e)return e;t=t.parentNode}},nt=t=>t.replace(W,Z),rt=t=>"span"===t.nodeName.toLowerCase()&&t.classList.contains("mce-nbsp-wrap"),st=(t,e)=>{const o=t.dom,n=et(q.fromDom(e),tt);p(n,(e=>{var n;const r=e.dom.parentNode;if(rt(r))_(q.fromDom(r),Y);else{const r=nt(o.encode(null!==(n=A(e))&&void 0!==n?n:"")),s=o.create("div",{},r);let i;while(i=s.lastChild)o.insertAfter(i,e.dom);t.dom.remove(e.dom)}}))},it=(t,e)=>{const o=t.dom.select(X,e);p(o,(e=>{rt(e)?F(q.fromDom(e),Y):t.dom.remove(e,!0)}))},at=t=>{const e=t.getBody(),o=t.selection.getBookmark();let n=ot(t.selection.getNode(),e);n=void 0!==n?n:e,it(t,n),st(t,n),t.selection.moveToBookmark(o)},lt=(t,e)=>{n(t,e.get());const o=t.getBody();!0===e.get()?st(t,o):it(t,o)},ct=(t,e)=>{e.set(!e.get());const o=t.selection.getBookmark();lt(t,e),t.selection.moveToBookmark(o)},ut=(t,e)=>{t.addCommand("mceVisualChars",(()=>{ct(t,e)}))},dt=t=>e=>e.options.get(t),mt=t=>{const e=t.options.register;e("visualchars_default_state",{processor:"boolean",default:!1})},ht=dt("visualchars_default_state"),gt=(t,e)=>{t.on("init",(()=>{lt(t,e)}))},vt=(t,e)=>{let o=null;const n=()=>{u(o)||(clearTimeout(o),o=null)},r=(...n)=>{u(o)&&(o=setTimeout((()=>{o=null,t.apply(null,n)}),e))};return{cancel:n,throttle:r}},ft=(t,e)=>{const o=vt((()=>{at(t)}),300);t.on("keydown",(n=>{!0===e.get()&&(13===n.keyCode?at(t):o.throttle())})),t.on("remove",o.cancel)},pt=(t,e)=>o=>{o.setActive(e.get());const n=t=>o.setActive(t.state);return t.on("VisualChars",n),()=>t.off("VisualChars",n)},wt=(t,e)=>{const o=()=>t.execCommand("mceVisualChars");t.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:pt(t,e)}),t.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:pt(t,e)})};var yt=()=>{e.add("visualchars",(e=>{mt(e);const n=t(ht(e));return ut(e,n),wt(e,n),ft(e,n),gt(e,n),o(n)}))};yt()})();