(function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=t=>e=>t===e,o=e(null),n=e(void 0),s=t=>null===t||void 0===t,r=t=>!s(t),a=()=>{},i=t=>()=>t,l=i(!1);class c{constructor(t,e){this.tag=t,this.value=e}static some(t){return new c(!0,t)}static none(){return c.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?c.some(t(this.value)):c.none()}bind(t){return this.tag?t(this.value):c.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:c.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!==t&&void 0!==t?t:"Called getOrDie on None")}static from(t){return r(t)?c.some(t):c.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}c.singletonNone=new c(!1);const u=(t,e)=>{for(let o=0,n=t.length;o<n;o++){const n=t[o];if(e(n,o))return!0}return!1},g=(t,e)=>{const o=t.length,n=new Array(o);for(let s=0;s<o;s++){const o=t[s];n[s]=e(o,s)}return n},m=(t,e)=>{for(let o=0,n=t.length;o<n;o++){const n=t[o];e(n,o)}},h=t=>{let e=t;const o=()=>e,n=t=>{e=t};return{get:o,set:n}},d=(t,e)=>{let n=null;const s=()=>{o(n)||(clearTimeout(n),n=null)},r=(...o)=>{s(),n=setTimeout((()=>{n=null,t.apply(null,o)}),e)};return{cancel:s,throttle:r}},p=(t,e)=>{t.insertContent(e)},y=Object.keys,v=Object.hasOwnProperty,f=(t,e)=>{const o=y(t);for(let n=0,s=o.length;n<s;n++){const s=o[n],r=t[s];e(r,s)}},b=(t,e)=>w(t,((t,o)=>({k:o,v:e(t,o)}))),w=(t,e)=>{const o={};return f(t,((t,n)=>{const s=e(t,n);o[s.k]=s.v})),o},_=(t,e)=>v.call(t,e),j=(t,e)=>e,C=t=>(...e)=>{if(0===e.length)throw new Error("Can't merge zero objects");const o={};for(let n=0;n<e.length;n++){const s=e[n];for(const e in s)_(s,e)&&(o[e]=t(o[e],s[e]))}return o},k=C(j),A=t=>{const e=h(c.none()),o=()=>e.get().each(t),n=()=>{o(),e.set(c.none())},s=()=>e.get().isSome(),r=()=>e.get(),a=t=>{o(),e.set(c.some(t))};return{clear:n,isSet:s,get:r,set:a}},O=()=>{const t=A(a),e=e=>t.get().each(e);return{...t,on:e}},x=(t,e,o)=>""===e||t.length>=e.length&&t.substr(o,o+e.length)===e,L=(t,e,o=0,s)=>{const r=t.indexOf(e,o);return-1!==r&&(!!n(s)||r+e.length<=s)},T=(t,e)=>x(t,e,0);var D=tinymce.util.Tools.resolve("tinymce.Resource");const E="tinymce.plugins.emoticons",S=t=>e=>e.options.get(t),F=(t,e)=>{const o=t.options.register;o("emoticons_database",{processor:"string",default:"emojis"}),o("emoticons_database_url",{processor:"string",default:`${e}/js/${N(t)}${t.suffix}.js`}),o("emoticons_database_id",{processor:"string",default:E}),o("emoticons_append",{processor:"object",default:{}}),o("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"})},N=S("emoticons_database"),P=S("emoticons_database_url"),$=S("emoticons_database_id"),I=S("emoticons_append"),z=S("emoticons_images_url"),M="All",R={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},U=(t,e)=>_(t,e)?t[e]:e,B=t=>{const e=I(t);return b(e,(t=>({keywords:[],category:"user",...t})))},q=(t,e,o)=>{const n=O(),s=O(),r=z(t),a=t=>T(t.char,"<img")?t.char.replace(/src="([^"]+)"/,((t,e)=>`src="${r}${e}"`)):t.char,i=t=>{const e={},o=[];f(t,((t,n)=>{const s={title:n,keywords:t.keywords,char:a(t),category:U(R,t.category)},r=void 0!==e[s.category]?e[s.category]:[];e[s.category]=r.concat([s]),o.push(s)})),n.set(e),s.set(o)};t.on("init",(()=>{D.load(o,e).then((e=>{const o=B(t);i(k(e,o))}),(t=>{console.log(`Failed to load emojis: ${t}`),n.set({}),s.set([])}))}));const l=t=>t===M?u():n.get().bind((e=>c.from(e[t]))).getOr([]),u=()=>s.get().getOr([]),g=()=>[M].concat(y(n.get().getOr({}))),m=()=>h()?Promise.resolve(!0):new Promise(((t,o)=>{let n=15;const s=setInterval((()=>{h()?(clearInterval(s),t(!0)):(n--,n<0&&(console.log("Could not load emojis from url: "+e),clearInterval(s),o(!1)))}),100)})),h=()=>n.isSet()&&s.isSet();return{listCategories:g,hasLoaded:h,waitForLoad:m,listAll:u,listCategory:l}},G=(t,e)=>L(t.title.toLowerCase(),e)||u(t.keywords,(t=>L(t.toLowerCase(),e))),H=(t,e,o)=>{const n=[],s=e.toLowerCase(),r=o.fold((()=>l),(t=>e=>e>=t));for(let a=0;a<t.length;a++)if((0===e.length||G(t[a],s))&&(n.push({value:t[a].char,text:t[a].title,icon:t[a].char}),r(n.length)))break;return n},J="pattern",K=(t,e)=>{const o={pattern:"",results:H(e.listAll(),"",c.some(300))},n=h(M),s=t=>{const o=t.getData(),s=n.get(),r=e.listCategory(s),a=H(r,o[J],s===M?c.some(300):c.none());t.setData({results:a})},r=d((t=>{s(t)}),200),a={label:"Search",type:"input",name:J},i={type:"collection",name:"results"},l=()=>{const s={type:"tabpanel",tabs:g(e.listCategories(),(t=>({title:t,name:t,items:[a,i]})))};return{title:"Emojis",size:"normal",body:s,initialData:o,onTabChange:(t,e)=>{n.set(e.newTabName),r.throttle(t)},onChange:r.throttle,onAction:(e,o)=>{"results"===o.name&&(p(t,o.value),e.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},u=t.windowManager.open(l());u.focus(J),e.hasLoaded()||(u.block("Loading emojis..."),e.waitForLoad().then((()=>{u.redial(l()),r.throttle(u),u.focus(J),u.unblock()})).catch((t=>{u.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),u.focus(J),u.unblock()})))},Q=(t,e)=>{t.addCommand("mceEmoticons",(()=>K(t,e)))},V=t=>{t.on("PreInit",(()=>{t.parser.addAttributeFilter("data-emoticon",(t=>{m(t,(t=>{t.attr("data-mce-resize","false"),t.attr("data-mce-placeholder","1")}))}))}))},W=(t,e)=>{t.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(t,o)=>e.waitForLoad().then((()=>{const n=e.listAll();return H(n,t,c.some(o))})),onAction:(e,o,n)=>{t.selection.setRng(o),t.insertContent(n),e.hide()}})},X=t=>{const e=()=>t.execCommand("mceEmoticons");t.ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:e}),t.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:e})};var Y=()=>{t.add("emoticons",((t,e)=>{F(t,e);const o=P(t),n=$(t),s=q(t,o,n);Q(t,s),X(t),W(t,s),V(t)}))};Y()})();