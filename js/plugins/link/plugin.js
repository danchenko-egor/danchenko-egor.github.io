(function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");const t=(e,t,n)=>{var o;return!!n(e,t.prototype)||(null===(o=e.constructor)||void 0===o?void 0:o.name)===t.name},n=e=>{const n=typeof e;return null===e?"null":"object"===n&&Array.isArray(e)?"array":"object"===n&&t(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":n},o=e=>t=>n(t)===e,r=e=>t=>typeof t===e,l=e=>t=>e===t,i=o("string"),s=o("object"),a=o("array"),c=l(null),u=r("boolean"),g=e=>null===e||void 0===e,d=e=>!g(e),m=r("function"),h=(e,t)=>{if(a(e)){for(let n=0,o=e.length;n<o;++n)if(!t(e[n]))return!1;return!0}return!1},f=()=>{},p=e=>()=>e,k=(e,t)=>e===t;class v{constructor(e,t){this.tag=e,this.value=t}static some(e){return new v(!0,e)}static none(){return v.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?v.some(e(this.value)):v.none()}bind(e){return this.tag?e(this.value):v.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:v.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!==e&&void 0!==e?e:"Called getOrDie on None")}static from(e){return d(e)?v.some(e):v.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}v.singletonNone=new v(!1);const y=Array.prototype.indexOf,x=Array.prototype.push,b=(e,t)=>y.call(e,t),_=(e,t)=>b(e,t)>-1,w=(e,t)=>{const n=e.length,o=new Array(n);for(let r=0;r<n;r++){const n=e[r];o[r]=t(n,r)}return o},C=(e,t)=>{for(let n=0,o=e.length;n<o;n++){const o=e[n];t(o,n)}},O=(e,t,n)=>(C(e,((e,o)=>{n=t(n,e,o)})),n),N=e=>{const t=[];for(let n=0,o=e.length;n<o;++n){if(!a(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);x.apply(t,e[n])}return t},A=(e,t)=>N(w(e,t)),T=(e,t)=>{for(let n=0;n<e.length;n++){const o=t(e[n],n);if(o.isSome())return o}return v.none()},S=(e,t,n=k)=>e.exists((e=>n(e,t))),R=e=>{const t=[],n=e=>{t.push(e)};for(let o=0;o<e.length;o++)e[o].each(n);return t},E=(e,t)=>e?v.some(t):v.none(),L=e=>t=>t.options.get(e),P=e=>{const t=e.options.register;t("link_assume_external_targets",{processor:e=>{const t=i(e)||u(e);return t?!0===e?{value:1,valid:t}:"http"===e||"https"===e?{value:e,valid:t}:{value:0,valid:t}:{valid:!1,message:"Must be a string or a boolean."}},default:!1}),t("link_context_toolbar",{processor:"boolean",default:!1}),t("link_list",{processor:e=>i(e)||m(e)||h(e,s)}),t("link_default_target",{processor:"string"}),t("link_default_protocol",{processor:"string",default:"https"}),t("link_target_list",{processor:e=>u(e)||h(e,s),default:!0}),t("link_rel_list",{processor:"object[]",default:[]}),t("link_class_list",{processor:"object[]",default:[]}),t("link_title",{processor:"boolean",default:!0}),t("allow_unsafe_link_target",{processor:"boolean",default:!1}),t("link_quicklink",{processor:"boolean",default:!1})},M=L("link_assume_external_targets"),D=L("link_context_toolbar"),U=L("link_list"),B=L("link_default_target"),I=L("link_default_protocol"),j=L("link_target_list"),K=L("link_rel_list"),z=L("link_class_list"),q=L("link_title"),V=L("allow_unsafe_link_target"),F=L("link_quicklink");var W=tinymce.util.Tools.resolve("tinymce.util.Tools");const $=e=>i(e.value)?e.value:"",G=e=>i(e.text)?e.text:i(e.title)?e.title:"",H=(e,t)=>{const n=[];return W.each(e,(e=>{const o=G(e);if(void 0!==e.menu){const r=H(e.menu,t);n.push({text:o,items:r})}else{const r=t(e);n.push({text:o,value:r})}})),n},J=(e=$)=>t=>v.from(t).map((t=>H(t,e))),Q=e=>J($)(e),X=(e,t)=>n=>({name:e,type:"listbox",label:t,items:n}),Y={sanitize:Q,sanitizeWith:J,createUi:X,getValue:$},Z=Object.keys,ee=Object.hasOwnProperty,te=(e,t)=>{const n=Z(e);for(let o=0,r=n.length;o<r;o++){const r=n[o],l=e[r];t(l,r)}},ne=e=>(t,n)=>{e[n]=t},oe=(e,t,n,o)=>{te(e,((e,r)=>{(t(e,r)?n:o)(e,r)}))},re=(e,t)=>{const n={};return oe(e,t,ne(n),f),n},le=(e,t)=>ee.call(e,t),ie=(e,t)=>le(e,t)&&void 0!==e[t]&&null!==e[t];var se=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),ae=tinymce.util.Tools.resolve("tinymce.util.URI");const ce=e=>d(e)&&"a"===e.nodeName.toLowerCase(),ue=e=>ce(e)&&!!me(e),ge=(e,t)=>{if(e.collapsed)return[];{const n=e.cloneContents(),o=n.firstChild,r=new se(o,n),l=[];let i=o;do{t(i)&&l.push(i)}while(i=r.next());return l}},de=e=>/^\w+:/i.test(e),me=e=>{var t,n;return null!==(n=null!==(t=e.getAttribute("data-mce-href"))&&void 0!==t?t:e.getAttribute("href"))&&void 0!==n?n:""},he=(e,t)=>{const n=["noopener"],o=e?e.split(/\s+/):[],r=e=>W.trim(e.sort().join(" ")),l=e=>(e=i(e),e.length>0?e.concat(n):n),i=e=>e.filter((e=>-1===W.inArray(n,e))),s=t?l(o):i(o);return s.length>0?r(s):""},fe=e=>e.replace(/\uFEFF/g,""),pe=(e,t)=>(t=t||e.selection.getNode(),_e(t)?v.from(e.dom.select("a[href]",t)[0]):v.from(e.dom.getParent(t,"a[href]"))),ke=(e,t)=>pe(e,t).isSome(),ve=(e,t)=>{const n=t.fold((()=>e.getContent({format:"text"})),(e=>e.innerText||e.textContent||""));return fe(n)},ye=e=>W.grep(e,ue).length>0,xe=e=>ge(e,ue).length>0,be=e=>{const t=e.schema.getTextInlineElements(),n=e=>1===e.nodeType&&!ce(e)&&!le(t,e.nodeName.toLowerCase()),o=pe(e).exists((e=>e.hasAttribute("data-mce-block")));if(o)return!1;const r=e.selection.getRng();if(r.collapsed)return!0;{const e=ge(r,n);return 0===e.length}},_e=e=>d(e)&&"FIGURE"===e.nodeName&&/\bimage\b/i.test(e.className),we=e=>{const t=["title","rel","class","target"];return O(t,((t,n)=>(e[n].each((e=>{t[n]=e.length>0?e:null})),t)),{href:e.href})},Ce=(e,t)=>"http"!==t&&"https"!==t||de(e)?e:t+"://"+e,Oe=(e,t)=>{const n={...t};if(0===K(e).length&&!V(e)){const e=he(n.rel,"_blank"===n.target);n.rel=e||null}return v.from(n.target).isNone()&&!1===j(e)&&(n.target=B(e)),n.href=Ce(n.href,M(e)),n},Ne=(e,t,n,o)=>{n.each((e=>{le(t,"innerText")?t.innerText=e:t.textContent=e})),e.dom.setAttribs(t,o),e.selection.select(t)},Ae=(e,t,n,o)=>{const r=e.dom;_e(t)?Ue(r,t,o):n.fold((()=>{e.execCommand("mceInsertLink",!1,o)}),(t=>{e.insertContent(r.createHTML("a",o,r.encode(t)))}))},Te=(e,t,n)=>{const o=e.selection.getNode(),r=pe(e,o),l=Oe(e,we(n));e.undoManager.transact((()=>{n.href===t.href&&t.attach(),r.fold((()=>{Ae(e,o,n.text,l)}),(t=>{e.focus(),Ne(e,t,n.text,l)}))}))},Se=e=>{const t=e.dom,n=e.selection,o=n.getBookmark(),r=n.getRng().cloneRange(),l=t.getParent(r.startContainer,"a[href]",e.getBody()),i=t.getParent(r.endContainer,"a[href]",e.getBody());l&&r.setStartBefore(l),i&&r.setEndAfter(i),n.setRng(r),e.execCommand("unlink"),n.moveToBookmark(o)},Re=e=>{e.undoManager.transact((()=>{const t=e.selection.getNode();_e(t)?De(e,t):Se(e),e.focus()}))},Ee=e=>{const{class:t,href:n,rel:o,target:r,text:l,title:i}=e;return re({class:t.getOrNull(),href:n,rel:o.getOrNull(),target:r.getOrNull(),text:l.getOrNull(),title:i.getOrNull()},((e,t)=>!1===c(e)))},Le=(e,t)=>{const n=e.options.get,o={allow_html_data_urls:n("allow_html_data_urls"),allow_script_urls:n("allow_script_urls"),allow_svg_data_urls:n("allow_svg_data_urls")},r=t.href;return{...t,href:ae.isDomSafe(r,"a",o)?r:""}},Pe=(e,t,n)=>{const o=Le(e,n);e.hasPlugin("rtc",!0)?e.execCommand("createlink",!1,Ee(o)):Te(e,t,o)},Me=e=>{e.hasPlugin("rtc",!0)?e.execCommand("unlink"):Re(e)},De=(e,t)=>{var n;const o=e.dom.select("img",t)[0];if(o){const r=e.dom.getParents(o,"a[href]",t)[0];r&&(null===(n=r.parentNode)||void 0===n||n.insertBefore(o,r),e.dom.remove(r))}},Ue=(e,t,n)=>{var o;const r=e.select("img",t)[0];if(r){const t=e.create("a",n);null===(o=r.parentNode)||void 0===o||o.insertBefore(t,r),t.appendChild(r)}},Be=e=>ie(e,"items"),Ie=(e,t)=>T(t,(t=>Be(t)?Ie(e,t.items):E(t.value===e,t))),je=(e,t,n,o)=>{const r=o[t],l=e.length>0;return void 0!==r?Ie(r,n).map((t=>({url:{value:t.value,meta:{text:l?e:t.text,attach:f}},text:l?e:t.text}))):v.none()},Ke=(e,t)=>"link"===t?e.link:"anchor"===t?e.anchor:v.none(),ze=(e,t)=>{const n={text:e.text,title:e.title},o=e=>{var t;return E(n.title.length<=0,v.from(null===(t=e.meta)||void 0===t?void 0:t.title).getOr(""))},r=e=>{var t;return E(n.text.length<=0,v.from(null===(t=e.meta)||void 0===t?void 0:t.text).getOr(e.value))},l=e=>{const t=r(e.url),n=o(e.url);return t.isSome()||n.isSome()?v.some({...t.map((e=>({text:e}))).getOr({}),...n.map((e=>({title:e}))).getOr({})}):v.none()},i=(e,o)=>{const r=Ke(t,o).getOr([]);return je(n.text,o,r,e)},s=(e,t)=>{const o=t.name;return"url"===o?l(e()):_(["anchor","link"],o)?i(e(),o):"text"===o||"title"===o?(n[o]=e()[o],v.none()):v.none()};return{onChange:s}},qe={init:ze,getDelta:je};var Ve=tinymce.util.Tools.resolve("tinymce.util.Delay");const Fe=(e,t,n)=>{const o=e.selection.getRng();Ve.setEditorTimeout(e,(()=>{e.windowManager.confirm(t,(t=>{e.selection.setRng(o),n(t)}))}))},We=e=>{const t=e.href,n=t.indexOf("@")>0&&-1===t.indexOf("/")&&-1===t.indexOf("mailto:");return n?v.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:e=>({...e,href:"mailto:"+t})}):v.none()},$e=(e,t)=>n=>{const o=n.href,r=1===e&&!de(o)||0===e&&/^\s*www(\.|\d\.)/i.test(o);return r?v.some({message:`The URL you entered seems to be an external link. Do you want to add the required ${t}:// prefix?`,preprocess:e=>({...e,href:t+"://"+o})}):v.none()},Ge=(e,t)=>T([We,$e(M(e),I(e))],(e=>e(t))).fold((()=>Promise.resolve(t)),(n=>new Promise((o=>{Fe(e,n.message,(e=>{o(e?n.preprocess(t):t)}))})))),He={preprocess:Ge},Je=e=>{const t=e.dom.select("a:not([href])"),n=A(t,(e=>{const t=e.name||e.id;return t?[{text:t,value:"#"+t}]:[]}));return n.length>0?v.some([{text:"None",value:""}].concat(n)):v.none()},Qe={getAnchors:Je},Xe=e=>{const t=z(e);return t.length>0?Y.sanitize(t):v.none()},Ye={getClasses:Xe},Ze=e=>{try{return v.some(JSON.parse(e))}catch(t){return v.none()}},et=e=>{const t=t=>e.convertURL(t.value||t.url||"","href"),n=U(e);return new Promise((e=>{i(n)?fetch(n).then((e=>e.ok?e.text().then(Ze):Promise.reject())).then(e,(()=>e(v.none()))):m(n)?n((t=>e(v.some(t)))):e(v.from(n))})).then((e=>e.bind(Y.sanitizeWith(t)).map((e=>{if(e.length>0){const t=[{text:"None",value:""}];return t.concat(e)}return e}))))},tt={getLinks:et},nt=(e,t)=>{const n=K(e);if(n.length>0){const o=S(t,"_blank"),r=!1===V(e),l=e=>he(Y.getValue(e),o),i=r?Y.sanitizeWith(l):Y.sanitize;return i(n)}return v.none()},ot={getRels:nt},rt=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],lt=e=>{const t=j(e);return a(t)?Y.sanitize(t).orThunk((()=>v.some(rt))):!1===t?v.none():v.some(rt)},it={getTargets:lt},st=(e,t,n)=>{const o=e.getAttrib(t,n);return null!==o&&o.length>0?v.some(o):v.none()},at=(e,t)=>{const n=e.dom,o=be(e),r=o?v.some(ve(e.selection,t)):v.none(),l=t.bind((e=>v.from(n.getAttrib(e,"href")))),i=t.bind((e=>v.from(n.getAttrib(e,"target")))),s=t.bind((e=>st(n,e,"rel"))),a=t.bind((e=>st(n,e,"class"))),c=t.bind((e=>st(n,e,"title")));return{url:l,text:r,title:c,target:i,rel:s,linkClass:a}},ct=(e,t)=>tt.getLinks(e).then((n=>{const o=at(e,t);return{anchor:o,catalogs:{targets:it.getTargets(e),rels:ot.getRels(e,o.target),classes:Ye.getClasses(e),anchor:Qe.getAnchors(e),link:n},optNode:t,flags:{titleEnabled:q(e)}}})),ut={collect:ct},gt=(e,t)=>n=>{const o=n.getData();if(!o.url.value)return Me(e),void n.close();const r=e=>v.from(o[e]).filter((n=>!S(t.anchor[e],n))),l={href:o.url.value,text:r("text"),target:r("target"),rel:r("rel"),class:r("linkClass"),title:r("title")},i={href:o.url.value,attach:void 0!==o.url.meta&&o.url.meta.attach?o.url.meta.attach:f};He.preprocess(e,l).then((t=>{Pe(e,i,t)})),n.close()},dt=e=>{const t=pe(e);return ut.collect(e,t)},mt=(e,t)=>{const n=e.anchor,o=n.url.getOr("");return{url:{value:o,meta:{original:{value:o}}},text:n.text.getOr(""),title:n.title.getOr(""),anchor:o,link:o,rel:n.rel.getOr(""),target:n.target.or(t).getOr(""),linkClass:n.linkClass.getOr("")}},ht=(e,t,n)=>{const o=[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],r=e.anchor.text.map((()=>({name:"text",type:"input",label:"Text to display"}))).toArray(),l=e.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],i=v.from(B(n)),s=mt(e,i),a=e.catalogs,c=qe.init(s,a),u={type:"panel",items:N([o,r,l,R([a.anchor.map(Y.createUi("anchor","Anchors")),a.rels.map(Y.createUi("rel","Rel")),a.targets.map(Y.createUi("target","Open link in...")),a.link.map(Y.createUi("link","Link list")),a.classes.map(Y.createUi("linkClass","Class"))])])};return{title:"Insert/Edit Link",size:"normal",body:u,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:s,onChange:(e,{name:t})=>{c.onChange(e.getData,{name:t}).each((t=>{e.setData(t)}))},onSubmit:t}},ft=e=>{const t=dt(e);t.then((t=>{const n=gt(e,t);return ht(t,n,e)})).then((t=>{e.windowManager.open(t)}))},pt=e=>{e.addCommand("mceLink",((t,n)=>{!0!==(null===n||void 0===n?void 0:n.dialog)&&F(e)?e.dispatch("contexttoolbar-show",{toolbarKey:"quicklink"}):ft(e)}))};var kt=tinymce.util.Tools.resolve("tinymce.util.VK");const vt=(e,t)=>{document.body.appendChild(e),e.dispatchEvent(t),document.body.removeChild(e)},yt=e=>{const t=document.createElement("a");t.target="_blank",t.href=e,t.rel="noreferrer noopener";const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),vt(t,n)},xt=(e,t)=>e.dom.getParent(t,"a[href]"),bt=e=>xt(e,e.selection.getStart()),_t=e=>!0===e.altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey,wt=(e,t)=>{if(t){const n=me(t);if(/^#/.test(n)){const t=e.dom.select(n);t.length&&e.selection.scrollIntoView(t[0],!0)}else yt(t.href)}},Ct=e=>()=>{e.execCommand("mceLink",!1,{dialog:!0})},Ot=e=>()=>{wt(e,bt(e))},Nt=e=>{e.on("click",(t=>{const n=xt(e,t.target);n&&kt.metaKeyPressed(t)&&(t.preventDefault(),wt(e,n))})),e.on("keydown",(t=>{if(!t.isDefaultPrevented()&&13===t.keyCode&&_t(t)){const n=bt(e);n&&(t.preventDefault(),wt(e,n))}}))},At=(e,t)=>(e.on("NodeChange",t),()=>e.off("NodeChange",t)),Tt=e=>t=>{const n=()=>t.setActive(!e.mode.isReadOnly()&&ke(e,e.selection.getNode()));return n(),At(e,n)},St=e=>t=>{const n=()=>t.setEnabled(ke(e,e.selection.getNode()));return n(),At(e,n)},Rt=e=>t=>{const n=t=>ye(t)||xe(e.selection.getRng()),o=e.dom.getParents(e.selection.getStart());return t.setEnabled(n(o)),At(e,(e=>t.setEnabled(n(e.parents))))},Et=e=>{e.addShortcut("Meta+K","",(()=>{e.execCommand("mceLink")}))},Lt=e=>{e.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:Ct(e),onSetup:Tt(e)}),e.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:Ot(e),onSetup:St(e)}),e.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:()=>Me(e),onSetup:Rt(e)})},Pt=e=>{e.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:Ot(e),onSetup:St(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:Ct(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:()=>Me(e),onSetup:Rt(e)})},Mt=e=>{const t="link unlink openlink",n="link";e.ui.registry.addContextMenu("link",{update:o=>ye(e.dom.getParents(o,"a"))?t:n})},Dt=e=>{const t=e=>{e.selection.collapse(!1)},n=t=>{const n=e.selection.getNode();return t.setEnabled(ke(e,n)),f},o=t=>{const n=pe(e),o=be(e);if(n.isNone()&&o){const o=ve(e.selection,n);return v.some(o.length>0?o:t)}return v.none()};e.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:Tt(e)},label:"Link",predicate:t=>D(e)&&ke(e,t),initValue:()=>{const t=pe(e);return t.fold(p(""),me)},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:t=>{const n=e.selection.getNode();return t.setActive(ke(e,n)),Tt(e)(t)},onAction:n=>{const r=n.getValue(),l=o(r),i={href:r,attach:f};Pe(e,i,{href:r,text:l,title:v.none(),rel:v.none(),target:v.none(),class:v.none()}),t(e),n.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:n,onAction:t=>{Me(e),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:n,onAction:t=>{Ot(e)(),t.hide()}}]})};var Ut=()=>{e.add("link",(e=>{P(e),Lt(e),Pt(e),Mt(e),Dt(e),Nt(e),pt(e),Et(e)}))};Ut()})();