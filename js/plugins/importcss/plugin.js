(function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");const t=(e,t,s)=>{var r;return!!s(e,t.prototype)||(null===(r=e.constructor)||void 0===r?void 0:r.name)===t.name},s=e=>{const s=typeof e;return null===e?"null":"object"===s&&Array.isArray(e)?"array":"object"===s&&t(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":s},r=e=>t=>s(t)===e,o=e=>t=>typeof t===e,n=r("string"),c=r("object"),i=r("array"),l=o("function");var a=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),p=tinymce.util.Tools.resolve("tinymce.EditorManager"),u=tinymce.util.Tools.resolve("tinymce.Env"),m=tinymce.util.Tools.resolve("tinymce.util.Tools");const f=e=>t=>t.options.get(e),y=e=>{const t=e.options.register,s=e=>n(e)||l(e)||c(e);t("importcss_merge_classes",{processor:"boolean",default:!0}),t("importcss_exclusive",{processor:"boolean",default:!0}),t("importcss_selector_converter",{processor:"function"}),t("importcss_selector_filter",{processor:s}),t("importcss_file_filter",{processor:s}),t("importcss_groups",{processor:"object[]"}),t("importcss_append",{processor:"boolean",default:!1})},d=f("importcss_merge_classes"),h=f("importcss_exclusive"),_=f("importcss_selector_converter"),g=f("importcss_selector_filter"),v=f("importcss_groups"),b=f("importcss_append"),x=f("importcss_file_filter"),T=f("skin"),S=f("skin_url"),k=Array.prototype.push,w=(e,t)=>{const s=e.length,r=new Array(s);for(let o=0;o<s;o++){const s=e[o];r[o]=t(s,o)}return r},A=e=>{const t=[];for(let s=0,r=e.length;s<r;++s){if(!i(e[s]))throw new Error("Arr.flatten item "+s+" was not an array, input: "+e);k.apply(t,e[s])}return t},E=(e,t)=>A(w(e,t)),I=()=>{const e=[],t=[],s={},r=(e,r)=>{s[e]?s[e].push(r):(t.push(e),s[e]=[r])},o=t=>{e.push(t)},n=()=>{const r=E(t,(e=>{const t=s[e];return 0===t.length?[]:[{title:e,items:t}]}));return r.concat(e)};return{addItemToGroup:r,addItem:o,toFormats:n}},M=/^\.(?:ephox|tiny-pageembed|mce)(?:[.-]+\w+)+$/,j=e=>{const t=u.cacheSuffix;return n(e)&&(e=e.replace("?"+t,"").replace("&"+t,"")),e},O=(e,t)=>{const s=T(e);if(s){const r=S(e),o=r?e.documentBaseURI.toAbsolute(r):p.baseURL+"/skins/ui/"+s,n=p.baseURL+"/skins/content/";return t===o+"/content"+(e.inline?".inline":"")+".min.css"||-1!==t.indexOf(n)}return!1},R=e=>n(e)?t=>-1!==t.indexOf(e):e instanceof RegExp?t=>e.test(t):e,U=e=>e.styleSheet,B=e=>e.selectorText,D=(e,t,s)=>{const r=[],o={},n=(t,o)=>{let c,i=t.href;if(i=j(i),i&&(!s||s(i,o))&&!O(e,i)){m.each(t.imports,(e=>{n(e,!0)}));try{c=t.cssRules||t.rules}catch(l){}m.each(c,(e=>{U(e)?n(e.styleSheet,!0):B(e)&&m.each(e.selectorText.split(","),(e=>{r.push(m.trim(e))}))}))}};m.each(e.contentCSS,(e=>{o[e]=!0})),s||(s=(e,t)=>t||o[e]);try{m.each(t.styleSheets,(e=>{n(e)}))}catch(c){}return r},F=(e,t)=>{let s={};const r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(!r)return;const o=r[1],n=r[2].substr(1).split(".").join(" "),c=m.makeMap("a,img");return r[1]?(s={title:t},e.schema.getTextBlockElements()[o]?s.block=o:e.schema.getBlockElements()[o]||c[o.toLowerCase()]?s.selector=o:s.inline=o):r[2]&&(s={inline:"span",title:t.substr(1),classes:n}),d(e)?s.classes=n:s.attributes={class:n},s},L=(e,t)=>m.grep(e,(e=>!e.filter||e.filter(t))),z=e=>m.map(e,(e=>m.extend({},e,{original:e,selectors:{},filter:R(e.filter)}))),C=(e,t)=>null===t||h(e),G=(e,t,s,r)=>!(C(e,s)?t in r:t in s.selectors),P=(e,t,s,r)=>{C(e,s)?r[t]=!0:s.selectors[t]=!0},$=(e,t,s,r)=>{let o;const n=_(e);return o=r&&r.selector_converter?r.selector_converter:n||(()=>F(e,s)),o.call(t,s,r)},q=e=>{e.on("init",(()=>{const t=I(),s={},r=R(g(e)),o=z(v(e)),n=(t,r)=>{if(G(e,t,r,s)){P(e,t,r,s);const o=$(e,e.plugins.importcss,t,r);if(o){const t=o.name||a.DOM.uniqueId();return e.formatter.register(t,o),{title:o.title,format:t}}}return null};m.each(D(e,e.getDoc(),R(x(e))),(e=>{if(!M.test(e)&&(!r||r(e))){const s=L(o,e);if(s.length>0)m.each(s,(s=>{const r=n(e,s);r&&t.addItemToGroup(s.title,r)}));else{const s=n(e,null);s&&t.addItem(s)}}}));const c=t.toFormats();e.dispatch("addStyleModifications",{items:c,replace:!b(e)})}))},H=e=>{const t=t=>F(e,t);return{convertSelectorToFormat:t}};var J=()=>{e.add("importcss",(e=>(y(e),q(e),H(e))))};J()})();