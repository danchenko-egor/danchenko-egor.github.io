(function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");const t=(e,t,r)=>{var a;return!!r(e,t.prototype)||(null===(a=e.constructor)||void 0===a?void 0:a.name)===t.name},r=e=>{const r=typeof e;return null===e?"null":"object"===r&&Array.isArray(e)?"array":"object"===r&&t(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":r},a=e=>t=>r(t)===e,o=a("string"),s=a("object"),i=a("array"),n=e=>null===e||void 0===e,c=e=>!n(e);class l{constructor(e,t){this.tag=e,this.value=t}static some(e){return new l(!0,e)}static none(){return l.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?l.some(e(this.value)):l.none()}bind(e){return this.tag?e(this.value):l.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:l.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!==e&&void 0!==e?e:"Called getOrDie on None")}static from(e){return c(e)?l.some(e):l.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}l.singletonNone=new l(!1);const m=Array.prototype.push,u=(e,t)=>{for(let r=0,a=e.length;r<a;r++){const a=e[r];t(a,r)}},d=e=>{const t=[];for(let r=0,a=e.length;r<a;++r){if(!i(e[r]))throw new Error("Arr.flatten item "+r+" was not an array, input: "+e);m.apply(t,e[r])}return t},h=e=>{let t=e;const r=()=>t,a=e=>{t=e};return{get:r,set:a}},p=Object.keys,g=Object.hasOwnProperty,b=(e,t)=>{const r=p(e);for(let a=0,o=r.length;a<o;a++){const o=r[a],s=e[o];t(s,o)}},w=(e,t)=>v(e,t)?l.from(e[t]):l.none(),v=(e,t)=>g.call(e,t),y=e=>t=>t.options.get(e),f=e=>{const t=e.options.register;t("audio_template_callback",{processor:"function"}),t("video_template_callback",{processor:"function"}),t("iframe_template_callback",{processor:"function"}),t("media_live_embeds",{processor:"boolean",default:!0}),t("media_filter_html",{processor:"boolean",default:!0}),t("media_url_resolver",{processor:"function"}),t("media_alt_source",{processor:"boolean",default:!0}),t("media_poster",{processor:"boolean",default:!0}),t("media_dimensions",{processor:"boolean",default:!0})},x=y("audio_template_callback"),_=y("video_template_callback"),k=y("iframe_template_callback"),j=y("media_live_embeds"),O=y("media_filter_html"),A=y("media_url_resolver"),S=y("media_alt_source"),C=y("media_poster"),D=y("media_dimensions");var T=tinymce.util.Tools.resolve("tinymce.util.Tools"),$=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),z=tinymce.util.Tools.resolve("tinymce.html.DomParser");const M=$.DOM,F=e=>e.replace(/px$/,""),N=e=>{const t=e.attr("style"),r=t?M.parseStyle(t):{};return{type:"ephox-embed-iri",source:e.attr("data-ephox-embed-iri"),altsource:"",poster:"",width:w(r,"max-width").map(F).getOr(""),height:w(r,"max-height").map(F).getOr("")}},R=(e,t)=>{let r={};const a=z({validate:!1,forced_root_block:!1},t),o=a.parse(e);for(let s=o;s;s=s.walk())if(1===s.type){const e=s.name;if(s.attr("data-ephox-embed-iri")){r=N(s);break}r.source||"param"!==e||(r.source=s.attr("movie")),"iframe"!==e&&"object"!==e&&"embed"!==e&&"video"!==e&&"audio"!==e||(r.type||(r.type=e),r=T.extend(s.attributes.map,r)),"script"===e&&(r={type:"script",source:s.attr("src")}),"source"===e&&(r.source?r.altsource||(r.altsource=s.attr("src")):r.source=s.attr("src")),"img"!==e||r.poster||(r.poster=s.attr("src"))}return r.source=r.source||r.src||"",r.altsource=r.altsource||"",r.poster=r.poster||"",r},U=e=>{var t;const r={mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"},a=null!==(t=e.toLowerCase().split(".").pop())&&void 0!==t?t:"";return w(r,a).getOr("")};var P=tinymce.util.Tools.resolve("tinymce.html.Node"),E=tinymce.util.Tools.resolve("tinymce.html.Serializer");const L=(e,t={})=>z({forced_root_block:!1,validate:!1,allow_conditional_comments:!0,...t},e),I=$.DOM,B=e=>/^[0-9.]+$/.test(e)?e+"px":e,G=(e,t)=>{const r=t.attr("style"),a=r?I.parseStyle(r):{};c(e.width)&&(a["max-width"]=B(e.width)),c(e.height)&&(a["max-height"]=B(e.height)),t.attr("style",I.serializeStyle(a))},W=["source","altsource"],q=(e,t,r,a)=>{let o=0,s=0;const i=L(a);i.addNodeFilter("source",(e=>o=e.length));const n=i.parse(e);for(let c=n;c;c=c.walk())if(1===c.type){const e=c.name;if(c.attr("data-ephox-embed-iri")){G(t,c);break}switch(e){case"video":case"object":case"embed":case"img":case"iframe":void 0!==t.height&&void 0!==t.width&&(c.attr("width",t.width),c.attr("height",t.height));break}if(r)switch(e){case"video":c.attr("poster",t.poster),c.attr("src",null);for(let r=o;r<2;r++)if(t[W[r]]){const e=new P("source",1);e.attr("src",t[W[r]]),e.attr("type",t[W[r]+"mime"]||null),c.append(e)}break;case"iframe":c.attr("src",t.source);break;case"object":const e=c.getAll("img").length>0;if(t.poster&&!e){c.attr("src",t.poster);const e=new P("img",1);e.attr("src",t.poster),e.attr("width",t.width),e.attr("height",t.height),c.append(e)}break;case"source":if(s<2&&(c.attr("src",t[W[s]]),c.attr("type",t[W[s]+"mime"]||null),!t[W[s]])){c.remove();continue}s++;break;case"img":t.poster||c.remove();break}}return E({},a).serialize(n)},H=[{regex:/youtu\.be\/([\w\-_\?&=.]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],J=e=>{const t=e.match(/^(https?:\/\/|www\.)(.+)$/i);return t&&t.length>1?"www."===t[1]?"https://":t[1]:"https://"},K=(e,t)=>{const r=J(t),a=e.regex.exec(t);let o=r+e.url;if(c(a))for(let s=0;s<a.length;s++)o=o.replace("$"+s,(()=>a[s]?a[s]:""));return o.replace(/\?$/,"")},Q=e=>{const t=H.filter((t=>t.regex.test(e)));return t.length>0?T.extend({},t[0],{url:K(t[0],e)}):null},V=(e,t)=>{if(t)return t(e);{const t=e.allowfullscreen?' allowFullscreen="1"':"";return'<iframe src="'+e.source+'" width="'+e.width+'" height="'+e.height+'"'+t+"></iframe>"}},X=e=>{let t='<object data="'+e.source+'" width="'+e.width+'" height="'+e.height+'" type="application/x-shockwave-flash">';return e.poster&&(t+='<img src="'+e.poster+'" width="'+e.width+'" height="'+e.height+'" />'),t+="</object>",t},Y=(e,t)=>t?t(e):'<audio controls="controls" src="'+e.source+'">'+(e.altsource?'\n<source src="'+e.altsource+'"'+(e.altsourcemime?' type="'+e.altsourcemime+'"':"")+" />\n":"")+"</audio>",Z=(e,t)=>t?t(e):'<video width="'+e.width+'" height="'+e.height+'"'+(e.poster?' poster="'+e.poster+'"':"")+' controls="controls">\n<source src="'+e.source+'"'+(e.sourcemime?' type="'+e.sourcemime+'"':"")+" />\n"+(e.altsource?'<source src="'+e.altsource+'"'+(e.altsourcemime?' type="'+e.altsourcemime+'"':"")+" />\n":"")+"</video>",ee=e=>'<script src="'+e.source+'"><\/script>',te=(e,t)=>{var r;const a=T.extend({},t);if(!a.source&&(T.extend(a,R(null!==(r=a.embed)&&void 0!==r?r:"",e.schema)),!a.source))return"";a.altsource||(a.altsource=""),a.poster||(a.poster=""),a.source=e.convertURL(a.source,"source"),a.altsource=e.convertURL(a.altsource,"source"),a.sourcemime=U(a.source),a.altsourcemime=U(a.altsource),a.poster=e.convertURL(a.poster,"poster");const o=Q(a.source);if(o&&(a.source=o.url,a.type=o.type,a.allowfullscreen=o.allowFullscreen,a.width=a.width||String(o.w),a.height=a.height||String(o.h)),a.embed)return q(a.embed,a,!0,e.schema);{const t=x(e),r=_(e),o=k(e);return a.width=a.width||"300",a.height=a.height||"150",T.each(a,((t,r)=>{a[r]=e.dom.encode(""+t)})),"iframe"===a.type?V(a,o):"application/x-shockwave-flash"===a.sourcemime?X(a):-1!==a.sourcemime.indexOf("audio")?Y(a,t):"script"===a.type?ee(a):Z(a,r)}},re=e=>e.hasAttribute("data-mce-object")||e.hasAttribute("data-ephox-embed-iri"),ae=e=>{e.on("click keyup touchend",(()=>{const t=e.selection.getNode();t&&e.dom.hasClass(t,"mce-preview-object")&&e.dom.getAttrib(t,"data-mce-selected")&&t.setAttribute("data-mce-selected","2")})),e.on("ObjectSelected",(e=>{const t=e.target.getAttribute("data-mce-object");"script"===t&&e.preventDefault()})),e.on("ObjectResized",(t=>{const r=t.target;if(r.getAttribute("data-mce-object")){let a=r.getAttribute("data-mce-html");a&&(a=unescape(a),r.setAttribute("data-mce-html",escape(q(a,{width:String(t.width),height:String(t.height)},!1,e.schema))))}}))},oe={},se=(e,t,r)=>new Promise(((a,o)=>{const s=r=>(r.html&&(oe[e.source]=r),a({url:e.source,html:r.html?r.html:t(e)}));oe[e.source]?s(oe[e.source]):r({url:e.source},s,o)})),ie=(e,t)=>Promise.resolve({html:t(e),url:e.source}),ne=e=>t=>te(e,t),ce=(e,t)=>{const r=A(e);return r?se(t,ne(e),r):ie(t,ne(e))},le=e=>v(oe,e),me=(e,t)=>w(t,e).bind((e=>w(e,"meta"))),ue=(e,t,r)=>a=>{const o=()=>w(e,a),i=()=>w(t,a),n=e=>w(e,"value").bind((e=>e.length>0?l.some(e):l.none())),c=()=>o().bind((e=>s(e)?n(e).orThunk(i):i().orThunk((()=>l.from(e))))),m=()=>i().orThunk((()=>o().bind((e=>s(e)?n(e):l.from(e)))));return{[a]:(a===r?c():m()).getOr("")}},de=(e,t)=>{const r={};return w(e,"dimensions").each((e=>{u(["width","height"],(a=>{w(t,a).orThunk((()=>w(e,a))).each((e=>r[a]=e))}))})),r},he=(e,t)=>{const r=t&&"dimensions"!==t?me(t,e).getOr({}):{},a=ue(e,r,t);return{...a("source"),...a("altsource"),...a("poster"),...a("embed"),...de(e,r)}},pe=e=>{const t={...e,source:{value:w(e,"source").getOr("")},altsource:{value:w(e,"altsource").getOr("")},poster:{value:w(e,"poster").getOr("")}};return u(["width","height"],(r=>{w(e,r).each((e=>{const a=t.dimensions||{};a[r]=e,t.dimensions=a}))})),t},ge=e=>t=>{const r=t&&t.msg?"Media embed handler error: "+t.msg:"Media embed handler threw unknown error.";e.notificationManager.open({type:"error",text:r})},be=e=>{const t=e.selection.getNode(),r=re(t)?e.serializer.serialize(t,{selection:!0}):"";return{embed:r,...R(r,e.schema)}},we=(e,t)=>r=>{if(o(r.url)&&r.url.trim().length>0){const a=r.html,o=R(a,t.schema),s={...o,source:r.url,embed:a};e.setData(pe(s))}},ve=(e,t)=>{const r=e.dom.select("*[data-mce-object]");for(let a=0;a<t.length;a++)for(let e=r.length-1;e>=0;e--)t[a]===r[e]&&r.splice(e,1);e.selection.select(r[0])},ye=(e,t)=>{const r=e.dom.select("*[data-mce-object]");e.insertContent(t),ve(e,r),e.nodeChanged()},fe=(e,t,r)=>{var a;t.embed=q(null!==(a=t.embed)&&void 0!==a?a:"",t,!1,r.schema),t.embed&&(e.source===t.source||le(t.source))?ye(r,t.embed):ce(r,t).then((e=>{ye(r,e.html)})).catch(ge(r))},xe=e=>{const t=be(e),r=h(t),a=pe(t),o=(t,r)=>{const a=he(r.getData(),"source");t.source!==a.source&&(we(v,e)({url:a.source,html:""}),ce(e,a).then(we(v,e)).catch(ge(e)))},s=t=>{var r;const a=he(t.getData()),o=R(null!==(r=a.embed)&&void 0!==r?r:"",e.schema);t.setData(pe(o))},i=(t,r)=>{const a=he(t.getData(),r),o=te(e,a);t.setData(pe({...a,embed:o}))},n=[{name:"source",type:"urlinput",filetype:"media",label:"Source"}],c=D(e)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:[],l={title:"General",name:"general",items:d([n,c])},m={type:"textarea",name:"embed",label:"Paste your embed code below:"},u={title:"Embed",items:[m]},p=[];S(e)&&p.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"}),C(e)&&p.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"});const g={title:"Advanced",name:"advanced",items:p},b=[l,u];p.length>0&&b.push(g);const w={type:"tabpanel",tabs:b},v=e.windowManager.open({title:"Insert/Edit Media",size:"normal",body:w,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:t=>{const a=he(t.getData());fe(r.get(),a,e),t.close()},onChange:(e,t)=>{switch(t.name){case"source":o(r.get(),e);break;case"embed":s(e);break;case"dimensions":case"altsource":case"poster":i(e,t.name);break}r.set(he(e.getData()))},initialData:a})},_e=e=>{const t=()=>{xe(e)};return{showDialog:t}},ke=e=>{const t=()=>{xe(e)};e.addCommand("mceMedia",t)},je=(e,t,r)=>""===t||e.length>=t.length&&e.substr(r,r+t.length)===t,Oe=(e,t)=>je(e,t,0);var Ae=tinymce.util.Tools.resolve("tinymce.Env");const Se=e=>{const t=e.name;return"iframe"===t||"video"===t||"audio"===t},Ce=(e,t,r,a=null)=>{const o=e.attr(r);return c(o)?o:v(t,r)?null:a},De=(e,t,r)=>{const a="img"===t.name||"video"===e.name,o=a?"300":null,s="audio"===e.name?"30":"150",i=a?s:null;t.attr({width:Ce(e,r,"width",o),height:Ce(e,r,"height",i)})},Te=(e,t,r,a)=>{const o=L(e.schema).parse(a,{context:t});while(o.firstChild)r.append(o.firstChild)},$e=(e,t)=>{const r=t.name,a=new P("img",1);return Me(e,t,a),De(t,a,{}),a.attr({style:t.attr("style"),src:Ae.transparentSrc,"data-mce-object":r,class:"mce-object mce-object-"+r}),a},ze=(e,t)=>{var r;const a=t.name,o=new P("span",1);o.attr({contentEditable:"false",style:t.attr("style"),"data-mce-object":a,class:"mce-preview-object mce-object-"+a}),Me(e,t,o);const s=e.dom.parseStyle(null!==(r=t.attr("style"))&&void 0!==r?r:""),i=new P(a,1);if(De(t,i,s),i.attr({src:t.attr("src"),style:t.attr("style"),class:t.attr("class")}),"iframe"===a)i.attr({allowfullscreen:t.attr("allowfullscreen"),frameborder:"0"});else{const r=["controls","crossorigin","currentTime","loop","muted","poster","preload"];u(r,(e=>{i.attr(e,t.attr(e))}));const s=o.attr("data-mce-html");c(s)&&Te(e,a,i,unescape(s))}const n=new P("span",1);return n.attr("class","mce-shim"),o.append(i),o.append(n),o},Me=(e,t,r)=>{var a;const o=null!==(a=t.attributes)&&void 0!==a?a:[];let s=o.length;while(s--){const t=o[s].name;let a=o[s].value;"width"===t||"height"===t||"style"===t||Oe(t,"data-mce-")||("data"!==t&&"src"!==t||(a=e.convertURL(a,t)),r.attr("data-mce-p-"+t,a))}const i=E({inner:!0},e.schema),n=new P("div",1);u(t.children(),(e=>n.append(e)));const c=i.serialize(n);c&&(r.attr("data-mce-html",escape(c)),r.empty())},Fe=e=>{const t=e.attr("class");return o(t)&&/\btiny-pageembed\b/.test(t)},Ne=e=>{let t=e;while(t=t.parent)if(t.attr("data-ephox-embed-iri")||Fe(t))return!0;return!1},Re=e=>t=>{let r,a=t.length;while(a--)r=t[a],r.parent&&(r.parent.attr("data-mce-object")||(Se(r)&&j(e)?Ne(r)||r.replace(ze(e,r)):Ne(r)||r.replace($e(e,r))))},Ue=(e,t,r)=>{const a=O(e);return L(e.schema,{validate:a}).parse(r,{context:t})},Pe=e=>{e.on("PreInit",(()=>{const{schema:t,serializer:r,parser:a}=e,o=t.getBoolAttrs();u("webkitallowfullscreen mozallowfullscreen".split(" "),(e=>{o[e]={}})),b({embed:["wmode"]},((e,r)=>{const a=t.getElementRule(r);a&&u(e,(e=>{a.attributes[e]={},a.attributesOrder.push(e)}))})),a.addNodeFilter("iframe,video,audio,object,embed,script",Re(e)),r.addAttributeFilter("data-mce-object",((t,r)=>{var a;let o=t.length;while(o--){const s=t[o];if(!s.parent)continue;const i=s.attr(r),n=new P(i,1);if("audio"!==i&&"script"!==i){const e=s.attr("class");e&&-1!==e.indexOf("mce-preview-object")&&s.firstChild?n.attr({width:s.firstChild.attr("width"),height:s.firstChild.attr("height")}):n.attr({width:s.attr("width"),height:s.attr("height")})}n.attr({style:s.attr("style")});const c=null!==(a=s.attributes)&&void 0!==a?a:[];let l=c.length;while(l--){const e=c[l].name;0===e.indexOf("data-mce-p-")&&n.attr(e.substr(11),c[l].value)}"script"===i&&n.attr("type","text/javascript");const m=s.attr("data-mce-html");if(m){const t=Ue(e,i,unescape(m));u(t.children(),(e=>n.append(e)))}s.replace(n)}}))})),e.on("SetContent",(()=>{const t=e.dom;u(t.select("span.mce-preview-object"),(e=>{0===t.select("span.mce-shim",e).length&&t.add(e,"span",{class:"mce-shim"})}))}))},Ee=e=>{e.on("ResolveName",(e=>{let t;1===e.target.nodeType&&(t=e.target.getAttribute("data-mce-object"))&&(e.name=t)}))},Le=e=>{const t=()=>e.execCommand("mceMedia");e.ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:t,onSetup:t=>{const r=e.selection;return t.setActive(re(r.getNode())),r.selectorChangedWithUnbind("img[data-mce-object],span[data-mce-object],div[data-ephox-embed-iri]",t.setActive).unbind}}),e.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:t})};var Ie=()=>{e.add("media",(e=>(f(e),ke(e),Le(e),Ee(e),Pe(e),ae(e),_e(e))))};Ie()})();